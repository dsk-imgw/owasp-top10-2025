# A09:2025 ログ記録およびアラートの失敗 <img src="./assets/TOP_10_Icons_Final_Security_Logging_and_Monitoring_Failures.png" style="height:80px;width:80px" align="right">


## 背景

ログ記録とアラートの失敗は、9 位を維持しました。このカテゴリは、関連するログ イベントへの対応を促すために必要なアラート機能を強調する目的で、若干の名称変更を行いました。このカテゴリは、データでは常に過小評価されており、コミュニティ アンケート参加者からの投票により 3 度目の選出となりました。このカテゴリはテストが非常に難しく、CVE/CVSS データへの反映も最小限（わずか 723 件）ですが、可視性、インシデント アラート、フォレンジックにおいて非常に大きな影響力を持つ可能性があります。このカテゴリには、*CWE-117: ログ ファイルへの出力エンコーディングの適切な処理*、*CWE-532: ログ ファイルへの機密データの挿入*、*CWE-778: 不十分なログ記録* に関する問題が含まれます。

## スコア表


<table>
  <tr>
   <td>対応する CWE 数
   </td>
   <td>インシデント割合（最大）
   </td>
   <td>インシデント割合（平均）
   </td>
   <td>カバレッジ（最大）
   </td>
   <td>カバレッジ（平均）
   </td>
   <td>重み付き悪用可能性（最大）
   </td>
   <td>重み付き悪用可能性（平均）
   </td>
   <td>総発生件数
   </td>
   <td>総 CVE 数
   </td>
  </tr>
  <tr>
   <td>5
   </td>
   <td>11.33%
   </td>
   <td>3.91%
   </td>
   <td>85.96%
   </td>
   <td>46.48%
   </td>
   <td>7.19
   </td>
   <td>2.65
   </td>
   <td>260,288
   </td>
   <td>723
   </td>
  </tr>
</table>



## 解説

ログ記録と監視がなければ、攻撃や侵害を検知できず、アラートがなければセキュリティ インシデント発生時に迅速かつ効果的に対応することは非常に困難です。積極的な対応を開始するためのログ記録、継続的な監視、検知、アラートが不十分な状況は、以下のような例がありますが、常に発生します。

* ログイン、ログインの失敗、高価値のトランザクションなどの監査対象イベントがログに記録されていない、または一貫性のないログ記録が行われています（例えば、成功したログインのみが記録され、失敗したログインは記録されない）。
* 警告やエラーが発生しても、ログ メッセージがまったく生成されない、不十分なログメッセージしか生成されない、あるいは不明瞭なログ メッセージが生成されます。
* ログの整合性が改ざんから適切に保護されていません。
* アプリケーションや API のログは、不審なアクティビティを監視していません。
* ログはローカルにのみ保存され、適切にバックアップされていません。
* 適切なアラートしきい値と対応エスカレーション プロセスが整備されていないか、有効ではありません。アラートは妥当な時間内に受信またはレビューされていません。
* ペネトレーション テストおよび動的アプリケーション セキュリティ テスト (DAST) ツール（Burp や ZAP など）によるスキャンでは、アラートがトリガーされません。
* アプリケーションは、アクティブな攻撃をリアルタイムまたはほぼリアルタイムで検出、エスカレーション、またはアラートすることができません。
* ログ記録およびアラート イベントをユーザーまたは攻撃者に公開したり（[A01:2025-アクセス制御の不備](A01_2025-Broken_Access_Control.md) を参照）、ログに記録すべきでない機密情報（PII や PHI など）をログに記録したりすると、機密情報の漏洩に対して脆弱になります。
* ログ データが正しくエンコードされていない場合、ログ記録システムまたは監視システムへのインジェクションや攻撃に対して脆弱になります。
* アプリケーションがエラーやその他の例外的な状況を認識していない、または適切に処理していないため、システムがエラーを認識できず、問題が発生したことをログに記録できません。
* アラートを発行するための適切な「ユース ケース」が不足しているか、古くなっているため、特別な状況を認識できません。
* 誤検知アラートが多すぎると、重要なアラートと重要でないアラートを区別できなくなり、アラートの認識が遅れたり、まったく認識されなかったりします（SOC チームの物理的な負荷が高まります）。
* ユース ケースのプレイブックが不完全、古い、または不足しているため、検出されたアラートを正しく処理できません。

## 防止方法

開発者は、アプリケーションのリスクに応じて、以下の管理策の一部またはすべてを実装する必要があります。

* ログイン、アクセス制御、サーバー側入力検証の失敗をすべて、十分なユーザー コンテキストでログに記録し、疑わしいアカウントや悪意のあるアカウントを特定できるようにし、後で行われるフォレンジック分析に十分な時間保持できるようにします。
* セキュリティ管理策を含むアプリケーションのすべての部分が、成功か失敗かに関わらずログに記録されるようにします。
* ログ管理ソリューションが容易に使用できる形式でログが生成されるようにします。
* ログ データが正しくエンコードされ、ログ システムや監視システムへのインジェクションや攻撃を防止できるようにします。
* すべてのトランザクションに、改ざんや削除を防ぐための整合性管理策（追記専用のデータベース テーブルなど）を備えた監査証跡があることを確実にします。
* エラーが発生したすべてのトランザクションがロール バックされ、最初からやり直されるようにします。常にフェイル クローズします。
* アプリケーションまたはそのユーザーが疑わしい動作をした場合は、アラートを発行します。開発者がこれに対処するためのコードを記述したり、システムを購入したりできるように、このトピックに関するガイダンスを作成します。
* DevSecOps およびセキュリティ チームは、セキュリティ オペレーション センター (SOC) チームによって疑わしいアクティビティが検出され、迅速に対応できるように、プレイブックを含む効果的な監視およびアラートのユース ケースを確立する必要があります。
* 攻撃者を罠にかける「ハニー トークン」を、アプリケーション（データベース、データなど）に、実在のユーザー ID や技術的ユーザー ID として追加します。ハニー トークンは通常の業務では使用されないため、アクセスがあった場合、ほぼ誤検知なしでアラートを生成できるログ データが生成されます。
* アラートの誤検知率を低減するために、振舞い分析と AI サポートをオプションで追加することも可能です。
* 米国国立標準技術研究所（NIST）800-61r2 以降に準拠したインシデント対応・復旧計画を策定または導入します。ソフトウェア開発者にアプリケーション攻撃やインシデントの発生状況を指導し、報告できるようにします。

OWASP ModSecurity Core Rule Set などの商用およびオープン ソースのアプリケーション保護製品や、Elasticsearch、Logstash、Kibana（ELK）スタックなどのオープン ソースのログ相関ソフトウェアには、カスタム ダッシュボードとアラート機能が搭載されており、これらの問題への対処に役立ちます。ほぼリアルタイムで攻撃に対応したりブロックしたりするのに役立つ商用の可観測性ツールもあります。


## 攻撃シナリオの例

**シナリオ #1:** 小児医療保険会社のウェブサイト運営者は、監視とログ記録の不足により、侵害を検知できませんでした。外部関係者から、攻撃者が 350 万人以上の小児の数千件の機密性の高い医療記録にアクセスし、改ざんしたとの報告を受けました。事後調査の結果、ウェブサイト開発者が重大な脆弱性に対処していなかったことが判明しました。システムのログ記録や監視が不十分であったため、データ侵害は 2013 年から 7 年以上にわたって進行していた可能性があります。

**シナリオ #2:** インドの大手航空会社で、パスポートやクレジット カード情報を含む、10 年以上にわたる数百万人の乗客の個人データが漏洩しました。データ漏洩はサード パーティのクラウド ホスティング プロバイダーで発生し、プロバイダーはしばらくして航空会社に漏洩を通知しました。

**シナリオ #3:** 欧州の大手航空会社が GDPR 報告義務違反に見舞われました。この違反は、攻撃者が決済アプリケーションのセキュリティ脆弱性を悪用したことが原因と報じられており、攻撃者は 40 万件以上の顧客決済記録を盗み出しました。この結果、航空会社は GDPR 規制当局から 2,000 万ポンドの罰金を科されました。


## 参考情報

* [OWASP Proactive Controls: C9: Implement Logging and Monitoring](https://top10proactive.owasp.org/archive/2024/the-top-10/c9-security-logging-and-monitoring/)
* [OWASP Application Security Verification Standard: V16 Security Logging and Error Handling](https://github.com/OWASP/ASVS/blob/v5.0.0/5.0/en/0x25-V16-Security-Logging-and-Error-Handling.md)
* [OWASP Cheat Sheet: Application Logging Vocabulary](https://cheatsheetseries.owasp.org/cheatsheets/Application_Logging_Vocabulary_Cheat_Sheet.html)
* [OWASP Cheat Sheet: Logging](https://cheatsheetseries.owasp.org/cheatsheets/Logging_Cheat_Sheet.html)
* [Data Integrity: Recovering from Ransomware and Other Destructive Events](https://csrc.nist.gov/publications/detail/sp/1800-11/final)
* [Data Integrity: Identifying and Protecting Assets Against Ransomware and Other Destructive Events](https://csrc.nist.gov/publications/detail/sp/1800-25/final)
* [Data Integrity: Detecting and Responding to Ransomware and Other Destructive Events](https://csrc.nist.gov/publications/detail/sp/1800-26/final)


## 対応する CWE の一覧

* [CWE-117 Improper Output Neutralization for Logs](https://cwe.mitre.org/data/definitions/117.html)
* [CWE-221 Information Loss of Omission](https://cwe.mitre.org/data/definitions/221.html)
* [CWE-223 Omission of Security-relevant Information](https://cwe.mitre.org/data/definitions/223.html)
* [CWE-532 Insertion of Sensitive Information into Log File](https://cwe.mitre.org/data/definitions/532.html)
* [CWE-778 Insufficient Logging](https://cwe.mitre.org/data/definitions/778.html)